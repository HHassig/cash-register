<div class="container" data-controller="items-index">
  <h1>For Sale</h1>
  <div class="categories">
    <h5 id="category">All</h5>
    <% @categories.each do |category| %>
      <h5 id="category"><%= category.titleize %></h5>
    <% end %>
    <div class="hover-container">
      <h5 class="hover-target" tabindex="0"><i class="fa-solid fa-cart-shopping"></i></h5>
      <aside class="hover-popup-cart">
        <h3>Cart</h3>
        <div class="cart-items"></div>
        <div class="subtotal"></div>
        <%= link_to(@transaction) do %>
          <h5><i class="fa-solid fa-credit-card"></i></h5>
        <% end %>
      </aside>
    </div>
  </div>
  <div class="items">
    <% @items.each do |item| %>
      <div class="item-card">
        <%= link_to "<img src='#{item.photo}'>".html_safe, item_path(item) %>
        <h3 id="item-name"><%= link_to item.name, item_path(item) %></h3>
        <div class="item-infos">
          <div class="hover-container">
            <i class="fa-solid fa-circle-info hover-target" tabindex="0"></i>
            <aside class="hover-popup">
              <p><%= item.description %></p>
            </aside>
          </div>
          <div class="add-remove">
            <i class="fa-solid fa-circle-minus"></i>
            <input type="text" class="amount-js" value="1">
            <i class="fa-solid fa-circle-plus"></i>
          </div>
        </div>
        <div class="item-infos">
          <strong id="item-price">â‚¬<%= '%.2f' % item.price %></strong>
          <% promotion = Promotion.find_by(item_id: item.id) %>
          <% unless promotion.nil?%>
            <div class="hover-container">
              <p class="hover-target" tabindex="0"><i class="fa-solid fa-piggy-bank"></i></p>
              <aside class="hover-popup-cart">
                <h5><%= link_to promotion.name, promotion_path(promotion) %></h5>
                <p><strong><%= promotion.discount.to_i %></strong>% off</p>
                <p><strong><%= promotion.min_quantity %></strong> minimum</p>
              </aside>
            </div>
            <div class="promotion-hidden"><%= promotion.id %></div>
          <% else %>
            <div class="promotion-hidden">0</div>
          <% end %>
          <i class="fa-solid fa-cart-plus"></i>
        </div>
        <div id="category-hidden"><%= item.category.titleize %></div>
        <div id="item-id-hidden"><%= item.id %></div>
        <div id="transaction-id-hidden"><%= @transaction.id %></div>
        <%= simple_form_for @basket, :html => { class: "basket-form-hidden" } do |f| %>
          <%= f.input :item_id, class: "basket-item-id" %>
          <%= f.input :transaction_id, class: "basket-transaction-id" %>
          <%= f.input :quantity, class: "basket-quantity" %>
          <%= f.input :promotion_id, class: "basket-promotion-id" %>
          <%= f.submit "Submit", class: "basket-submit" %>
        <% end %>
      </div>
    <% end %>
  </div>
</div>
